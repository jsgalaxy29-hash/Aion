aion:
  name: "Aion ERP"
  version: "0.4.0-preview"
  description: "Source de vérité modulaire : modules, menus, métabase, droits, actions, rapports, endpoints."
  regen_command: "dotnet run --project Aion.AppHost -- --regen-meta"

  conventions:
    environments: "agnostic"
    naming:
      system_tables_prefix: "S"
      reference_tables_prefix: "R"
      feature_tables_prefix: "F"
    menus:
      id_strategy: "code"          # Pas de plages numériques; l’engine génère un ID interne
      code_format: "[A-Z0-9_]+"
      route_format: "/modules/{moduleCode}"
    icons:
      library: "Lucide"            # ou Fluent, selon dispo UI
    palette:
      system:
        primary: "#0E639C"
        success: "#107C10"
        warning: "#C19C00"
        danger:  "#C50F1F"
        neutral: "#2B2B2B"
    security:
      multi_tenant:
        enabled: true
        tenant_table: "STenant"
        tenant_key_name: "TenantId"
        enforce_on:
          - scope: "all_feature_tables"
          - scope: "users"        # SUser peut porter TenantId si multi-tenant strict
      password_hashing:
        provider: "BCrypt"
        work_factor: 12
      rbac:
        merge_rule: "most_permissive_wins"
        targets:
          - target: "Menu"
            flags: ["Right1"]                    # Voir
          - target: "Module"
            flags: ["Right1","Right2","Right3","Right4","Right5"]   # Lire, Écrire, Suppr, Export, Admin
          - target: "Table"
            flags: ["Right1","Right2","Right3","Right4","Right5"]
          - target: "Action"
            flags: ["Right1"]                    # Exécuter
          - target: "Report"
            flags: ["Right1","Right2"]           # Voir, Générer
    data_policies:
      soft_delete:
        enabled: true
        fields:
          is_deleted: "IsDeleted"
          deleted_at: "DeletedAt"
          deleted_by: "DeletedBy"
      audit_trail:
        enabled: false   # journalisation avancée (S_Audit) désactivée pour 0.3.x

  multi_tenant:
    enabled: true
    tenant_field: "TenantId"

  ai:
    intents:
      engine: "RuleBasedIntentRecognizer"
      description: "Analyse les commandes naturelles et les mappe sur des intentions métiers (modules, tables, actions)."
    planner:
      engine: "SimplePlanner"
      description: "Construit les étapes à exécuter pour aligner le code et la roadmap."
    patcher:
      engine: "YamlRoadmapPatcher"
      description: "Génère les diffs YAML pour `AION_ROADMAP.yaml`."
    simulator:
      engine: "InMemorySimulator"
      description: "Exécute le plan dans un bac à sable pour produire les artefacts (fichiers, scripts, rapports)."
    audit:
      table: "SAuditRecord"
      provider: "DatabaseAuditTrailService"

  system_schema:
    tables:
      - name: "SUser"
      - name: "SGroup"
      - name: "SUserGroup"
      - name: "SRightType"
      - name: "SRight"
      - name: "SMenu"
      - name: "STable"
      - name: "SField"
      - name: "SModule"
      - name: "SAction"
      - name: "STenant"     # requis par multi-tenant
    rules:
      tenant_required_on_feature_tables: true
      seed:
        right_types:
          - code: "Menu.Right1"    # Voir
          - code: "Module.Right1"  # Lire
          - code: "Module.Right2"  # Écrire
          - code: "Module.Right3"  # Supprimer
          - code: "Module.Right4"  # Exporter
          - code: "Module.Right5"  # Admin
          - code: "Table.Right1"
          - code: "Table.Right2"
          - code: "Table.Right3"
          - code: "Table.Right4"
          - code: "Table.Right5"
          - code: "Action.Right1"
          - code: "Report.Right1"
          - code: "Report.Right2"

  modules:

    - code: "SYSTEM_CATALOG"
      name: "Catalogue système"
      color: "#107C10"
      icon: "Layers"
      menus:
        - code: "SYSTEM_CATALOG_ROOT"
          label: "Catalogue système"
          route: "/modules/SYSTEM_CATALOG"
          is_leaf: true
          icon: "Layers"
      tables:
        - "SMenu"
        - "STable"
        - "SField"
        - "SModule"
        - "SAction"
      actions:
        - code: "RefreshMetadata"
          label: "Rafraîchir les métadonnées"
          right: { target: "Action", flag: "Right1" }
      reports: []
      endpoints:
        - method: "GET"
          route: "/api/system/catalog/menus"
        - method: "POST"
          route: "/api/system/catalog/metadata/sync"
      rights:
        defaults:
          group: "Administrators"
          grants:
            - target: "Module"
              flags: ["Right1","Right2","Right3","Right4","Right5"]

    - code: "SECURITY_ADMIN"
      name: "Administration sécurité"
      color: "#0E639C"
      icon: "ShieldCheck"
      menus:
        - code: "SECURITY_ADMIN_ROOT"
          label: "Sécurité"
          route: "/modules/SECURITY_ADMIN"
          is_leaf: true
          icon: "ShieldCheck"
      tables:
        - "SUser"
        - "SGroup"
        - "SUserGroup"
        - "SRightType"
        - "SRight"
        - "STenant"
      actions:
        - code: "ResetPassword"
          label: "Réinitialiser le mot de passe"
          right: { target: "Action", flag: "Right1" }
      reports:
        - code: "SecurityAudit"
          label: "Audit des connexions"
      endpoints:
        - method: "POST"
          route: "/api/security/users/{id}/reset-password"

    - code: "DATA_ENGINE"
      name: "Moteur de données"
      color: "#7A3E9D"
      icon: "Database"
      menus:
        - code: "DATA_ENGINE_ROOT"
          label: "Moteur de données"
          route: "/modules/DATA_ENGINE"
          is_leaf: true
          icon: "Database"
      tables:
        - "SXAiConfig"
        - "SXSynonym"
        - "SXTemplate"
        - "SAuditRecord"
      actions:
        - code: "RegenMetadata"
          label: "Régénérer les métadonnées"
          right: { target: "Action", flag: "Right1" }
        - code: "RebuildCache"
          label: "Reconstruire le cache"
          right: { target: "Action", flag: "Right1" }
      reports:
        - code: "MetadataCoverage"
          label: "Couverture des métadonnées"
      endpoints:
        - method: "POST"
          route: "/api/data-engine/refresh"

    - code: "ACTION_ENGINE"
      name: "Moteur d’actions"
      color: "#2B2B2B"
      icon: "Play"
      menus:
        - code: "ACTION_ENGINE_ROOT"
          label: "Moteur d’actions"
          route: "/modules/ACTION_ENGINE"
          is_leaf: true
          icon: "Play"
      tables: []
      actions:
        - code: "ExecuteScheduled"
          label: "Exécuter les actions planifiées"
          right: { target: "Action", flag: "Right1" }
      reports: []
      endpoints:
        - method: "POST"
          route: "/api/actions/run"

    - code: "REPORT_ENGINE"
      name: "Moteur de rapports"
      color: "#0E639C"
      icon: "BarChart"
      menus:
        - code: "REPORT_ENGINE_ROOT"
          label: "Moteur de rapports"
          route: "/modules/REPORT_ENGINE"
          is_leaf: true
          icon: "BarChart"
      tables:
        - "SReport"
      actions: []
      reports: []   # placeholder pour 0.4.x
      endpoints:
        - method: "POST"
          route: "/api/reports/run"

    - code: "CRM"
      name: "CRM"
      color: "#107C10"
      icon: "Users"
      menus:
        - code: "CRM_ROOT"
          label: "CRM"
          route: "/modules/CRM"
          is_leaf: false
          icon: "Users"
        - code: "CRM_COMPANIES"
          parent_code: "CRM_ROOT"
          label: "Entreprises"
          route: "/modules/CRM/companies"
          is_leaf: true
          icon: "Building"
        - code: "CRM_CONTACTS"
          parent_code: "CRM_ROOT"
          label: "Contacts"
          route: "/modules/CRM/contacts"
          is_leaf: true
          icon: "Contact"
      tables:
        - "FCompany"
        - "FContact"
      actions:
        - code: "ImportCompanies"
          label: "Importer les entreprises"
          right: { target: "Action", flag: "Right1" }
      reports:
        - code: "SalesPipeline"
          label: "Pipeline des ventes"
      endpoints:
        - method: "GET"
          route: "/api/crm/companies"
        - method: "GET"
          route: "/api/crm/contacts"

    - code: "TABLE_MANAGER"
      name: "Table Manager"
      tables: [STable, SField]
      actions:
        - code: "InspectTable"
          label: "Inspecter une table SQL"
          right: { target: "Action", flag: "Right1" }
      reports: []
      endpoints:
        - method: "GET"
          route: "/api/table-manager/tables"

    - code: "LIST_DYN"
      name: "Dynamic List"
      tables: []
      actions:
        - code: "PersistFilters"
          label: "Sauvegarder les filtres utilisateur"
          right: { target: "Action", flag: "Right1" }
      reports: []
      endpoints:
        - method: "POST"
          route: "/api/list-dyn/preferences"

    - code: "FORM_DYN"
      name: "Dynamic Form"
      tables: []
      actions:
        - code: "ValidateLayout"
          label: "Valider un layout dynamique"
          right: { target: "Action", flag: "Right1" }
      reports: []
      endpoints:
        - method: "POST"
          route: "/api/form-dyn/validate"

    - code: "AI_ENGINE"
      name: "AI Engine"
      tables: [SAudit, SAuditRecord]
      actions:
        - code: "GeneratePlan"
          label: "Générer un plan IA"
          right: { target: "Action", flag: "Right1" }
      reports:
        - code: "AiUsage"
          label: "Journal des générations"
      endpoints:
        - method: "POST"
          route: "/api/ai/generate"

  endpoints: []     # section préparée mais vide (0.4.x)

  reports: []       # central registry optionnel, conservé vide pour 0.4.x

  - code: "AI_MODULE_BUILDER"
    name: "Natural Language Module Builder"
    type: "core"
    description: "Permet de créer des modules Aion à partir d'une description en langage naturel."
    tables:
      - AiModuleBlueprint
      - AiTableBlueprint
      - AiFieldBlueprint
    menus:
      - path: "/modules/ai-designer"
        label: "Designer IA"
        access: "admin"
    actions:
      - code: "AnalyzePrompt"
        label: "Analyser"
      - code: "GenerateModule"
        label: "Générer le module"
